%% TIKZ DRAWING OF CLEAR EXPERIMENTAL BEAMLINE 1 ELEMENTS
%% TO BE INCLUDED INTO A LATEX DOCUMENT
%% K. Sjobak, 2018

\begin{tikzpicture}
    %BEAM INSTRUMENTATION TEST STAND AREA
    \filldraw[green] (11.3,-0.4) rectangle (13.7,0.4);
    \node at ({(11.3+13.7)/2},-2.25) {\textbf{BI test area}};

    %CLIC test area
    \filldraw[green] (10.9,-0.5) rectangle (6.55,0.5);
    \node at ({(10.3+7.8)/2},-2.25) {\textbf{CLIC test area}};

    %IN-AIR table
    \filldraw[green] (-0.6,-0.5) rectangle (0.5,0.5);
    \node[align=left,anchor=west] at (-0.6,1.0) {\textbf{In-Air}\\ \textbf{test area}};
    \filldraw[gray] (-0.6,-2.0) rectangle (-0.5,0.5);

    % PLASMA LENS
    \filldraw[green] (3.45,-0.7) rectangle (4.6,0.7);

    %THE BEAM
    \draw[latex-,ultra thick] (0,0)--(16,0);

    \kickerHV[0]{15.8}{BHB 400}{1}{blue};

    \lensF{15.4}{QFD 510};
    \lensD{15.0}{QDD 515};
    \lensF{14.6}{QFD 520};
    \node at (15.0,1) {\belemsiz 22.86~m};

    \iBPM{14.1}{BPM 530};

    \correctorMagnet{13.8}{DJ 540};
    \node at (13.8,1) {\belemsiz 23.98~m};

    \BTV{13.3}{(BTV 545)};

    \filldraw[purple] (12.7+0.15,0.15) rectangle (12.7-0.15,-0.15);
    \node[rotate=-90,anchor=west] at (12.7,-0.7)
        {\belemsiz WCM 550};

    \correctorMagnet{12.4}{DJ 590};
    \node at (12.4,1) {\belemsiz 25.21~m};

    \iBPM{12.0} {BPM 595}; %{BPM 560};

    \filldraw[purple] (11.5+0.15,0.15) rectangle (11.5-0.15,-0.15);
    \node[rotate=-90,anchor=west] at (11.5,-0.7)
        {\belemsiz BPR 600};

    %\cBPM{11.1}{BPC 565}{0.15};
    \cBPM{11.1}{BPC 610}{0.15};

    \BTV{10.5}{BTV 620};
    \node at (10.5,1) {\belemsiz 26.04~m};

    \draw[ultra thick, orange] (10.1,-0.4) rectangle (9.7,0.4);
    \node[rotate=-90,anchor=west] at (9.9,-0.7)
        {\belemsiz ACS 640};

    \draw[ultra thick, orange] (9.6,-0.4) rectangle (9.2,0.4);
    \filldraw[purple] (9.55,-0.5) rectangle (9.5,0.5);
    \node[rotate=-90,anchor=west,align=left] at (9.4,-0.7)
        {\belemsiz WFM 645\\[-0.5em]
         \belemsiz ACS 650};

    \cBPM{9.0}{BPC 660}{0.1};
    \cBPM{8.7}{BPC 670}{0.1};
    \cBPM{8.4}{BPC 680}{0.1};
    \cBPM{8.1}{BPC 690}{0.1};

    \correctorMagnet{7.8}{DJ 710};
    \node at (7.8,0.9) {\belemsiz 29.31~m};

    \cBPM{7.5}{BPC 720}{0.15};

    \BTV{6.9}{BTV 730};
    \node at (6.9,0.65) {\belemsiz 29.75~m};

    \lensF{6.3}{QFD 760};
    \lensD{5.9}{QDD 765};
    \lensF{5.5}{QFD 770};
    \node at (5.9,0.9) {\belemsiz 30.62~m};


    \correctorMagnet{5.1}{DJ 780};
    \node at (5.1,1.15) {\belemsiz 31.66~m};

    \cBPM{4.8}{BPC 790}{0.15};

    \lensF[green!30]{4.3}{PLC 800\\[-0.5em]
             \belemsiz BTV 800\\[-0.5em]
             \belemsiz BTV 805};
    \node at (4.3,-2.25) {\textbf{Plasma lens}};
    \node at (4.3,0.9) {\belemsiz 32.26~m};

    \BTV{3.8}{BTV 810};
    \node at (3.8,1.15) {\belemsiz 32.53~m};

    \iBPM{3.2}{BPM 820};

    \correctorMagnet{2.8}{DJ 840};
    \node at (2.8,0.9) {\belemsiz 33.38~m};

    \lensD{2.3}{QDD 870};
    \node at (2.3,1.15) {\belemsiz 33.92~m};
    \lensF{1.9}{QFD 880};

    %% IN-AIR SPECTROMETER

    \pgfmathsetmacro{\InAirStart}{1.5};
    \pgfmathsetmacro{\InAirAngle}{-22.0};
    \pgfmathsetmacro{\InAirY}{(\InAirStart+0.6)*tan(\InAirAngle)};

    \draw[-latex,ultra thick] (\InAirStart,0)--(-0.6,\InAirY);
    \kickerHV[0]{\InAirStart}{BHB 900}{1}{blue};
    \node at (\InAirStart,0.9) {\belemsiz 35.03~m};

    \pgfmathsetmacro{\InAirBTVaX}{0.0};
    \pgfmathsetmacro{\InAirBTVaY}{(\InAirStart-\InAirBTVaX)*tan(\InAirAngle)};
    \BTV[\InAirBTVaY]{\InAirBTVaX}{BTV930};

    \pgfmathsetmacro{\InAirBPMx}{0.5};
    \pgfmathsetmacro{\InAirBPMy}{(\InAirStart-\InAirBPMx)*tan(\InAirAngle)};
    \iBPM[\InAirBPMy]{\InAirBPMx}{BPM920};

    %% IN-AIR TABLE INSTRUMENTATION
    \BTV{0.9}{BTV 910};
%    \node[anchor=south] at (0.9,0.3) {\belemsiz BTV 910};

    %ICT 210
    \filldraw[purple] (0.5-0.1/2,-0.3) rectangle (0.5+0.1/2,0.3);
    \node[anchor=south] at (0.5,0.3) {\belemsiz ICT 915};

    %% RF SYSTEM
    \filldraw[orange] (11.5,0.5) -- (11.5+0.5,1.5) -- (11.5-0.5,1.5) -- cycle;
    \draw[ultra thick, orange,] (11.5,1.25) -- (9.6,1.25);
    \draw[ultra thick, orange, dashed, -latex] (9.6,1.25) -- (9.6,0.4);
    \draw[ultra thick, orange, dashed, -latex] (9.6,1.25) -- (9.6,0.8) -- (10.1,0.8) -- (10.1,0.4);
    \node[align=center,anchor=north] at (11.5,1.5) {\belemsiz MKX\\ \belemsiz 1};

  \end{tikzpicture}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../IPAC2019_CLEAR.tex"
%%% End:
